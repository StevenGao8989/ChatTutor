# ChatTutor 完整运行指南

## 目录
- [项目简介](#项目简介)
- [环境要求](#环境要求)
- [方式一：直接运行（推荐）](#方式一直接运行推荐)
- [方式二：Docker 运行](#方式二docker-运行)
- [配置说明](#配置说明)
- [启动和使用](#启动和使用)
- [常见问题](#常见问题)
- [故障排除](#故障排除)

---

## 项目简介

ChatTutor（Fogsight）是一款由大型语言模型（LLM）驱动的动画生成工具。用户输入抽象概念或词语，ChatTutor 会将其转化为高水平的生动动画。

**核心功能：**
- 概念即影像：输入主题，自动生成完整的动画
- 智能编排：AI 自动完成整个创作流程
- 语言用户界面：支持多轮对话，精准调优动画效果

---

## 环境要求

### 基础环境
- **Python**: 3.9 或更高版本
- **操作系统**: Windows、macOS 或 Linux
- **浏览器**: Chrome、Firefox、Edge 等现代浏览器

### API 密钥
您需要准备以下之一：
- **Google Gemini API 密钥**（推荐使用 Gemini 2.5 Pro）
- **OpenRouter API 密钥**（支持多种模型）

### 可选环境（Docker 方式）
- **Docker**: 20.10 或更高版本
- **Docker Compose**: 1.29 或更高版本

---

## 方式一：直接运行（推荐）

### 步骤 1：克隆或下载项目

如果您使用 Git：
```bash
git clone https://github.com/fogsightai/fogsight.git
cd fogsight
```

或者直接下载项目 ZIP 文件并解压。

### 步骤 2：安装 Python 依赖

```bash
# 确保使用 Python 3.9+
python --version

# 安装依赖包
pip install -r requirements.txt
```

**注意：** 如果您的系统有多个 Python 版本，可能需要使用 `python3` 和 `pip3`：
```bash
python3 --version
pip3 install -r requirements.txt
```

### 步骤 3：配置 API 密钥

1. **复制配置文件模板：**
   ```bash
   cp demo-credentials.json credentials.json
   ```

2. **编辑 `credentials.json` 文件：**

   **选项 A：使用 Google Gemini（推荐）**
   ```json
   {
       "API_KEY": "您的Gemini_API密钥",
       "BASE_URL": "",
       "MODEL": "gemini-2.5-pro"
   }
   ```
   - 获取 Gemini API 密钥：访问 [Google AI Studio](https://makersuite.google.com/app/apikey)
   - `BASE_URL` 留空即可
   - `MODEL` 推荐使用 `gemini-2.5-pro`

   **选项 B：使用 OpenRouter**
   ```json
   {
       "API_KEY": "sk-or-v1-您的OpenRouter密钥",
       "BASE_URL": "https://openrouter.ai/api/v1",
       "MODEL": "anthropic/claude-sonnet-4"
   }
   ```
   - 获取 OpenRouter API 密钥：访问 [OpenRouter](https://openrouter.ai/)
   - `BASE_URL` 必须设置为 `https://openrouter.ai/api/v1`
   - `MODEL` 可以是 OpenRouter 支持的任何模型

### 步骤 4：启动应用

**方法 A：使用启动脚本（最简单）**
```bash
python start_fogsight.py
```
脚本会自动：
- 启动后端服务（默认端口 8000）
- 在浏览器中打开 `http://127.0.0.1:8000`

**方法 B：手动启动**
```bash
# 启动 FastAPI 服务器
python -m uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```
然后在浏览器中访问 `http://localhost:8000`

**方法 C：直接运行 app.py**
```bash
python app.py
```

### 步骤 5：开始使用

1. 在浏览器中打开应用界面
2. 在输入框中输入一个主题（例如："冒泡排序"、"熵增定律"、"欧拉定理"）
3. 点击生成按钮
4. 等待动画生成完成

---

## 方式二：Docker 运行

### 步骤 1：确保 Docker 已安装

检查 Docker 是否已安装：
```bash
docker --version
docker-compose --version
```

如果未安装，请访问 [Docker 官网](https://www.docker.com/) 下载安装。

### 步骤 2：克隆或下载项目

```bash
git clone https://github.com/fogsightai/fogsight.git
cd fogsight
```

### 步骤 3：配置 API 密钥

1. **复制配置文件：**
   ```bash
   cp demo-credentials.json credentials.json
   ```

2. **编辑 `credentials.json`：**
   参考 [方式一：步骤 3](#步骤-3配置-api-密钥) 的配置说明

### 步骤 4：使用 Docker Compose 启动

**使用默认端口（8000）：**
```bash
docker-compose up -d
```

**使用自定义端口（例如 3000）：**
```bash
HOST_PORT=3000 docker-compose up -d
```

**查看运行状态：**
```bash
docker-compose ps
```

**查看日志：**
```bash
docker-compose logs -f
```

### 步骤 5：访问应用

打开浏览器访问：
- 默认端口：`http://localhost:8000`
- 自定义端口：`http://localhost:您设置的端口`

### 步骤 6：停止服务

```bash
# 停止并删除容器
docker-compose down

# 停止但保留容器
docker-compose stop
```

---

## 配置说明

### credentials.json 配置详解

| 字段 | 说明 | 示例 |
|------|------|------|
| `API_KEY` | API 密钥 | `"sk-or-v1-xxx"` 或 `"AIzaSy..."` |
| `BASE_URL` | API 基础 URL | `"https://openrouter.ai/api/v1"` 或 `""` |
| `MODEL` | 使用的模型名称 | `"gemini-2.5-pro"` 或 `"anthropic/claude-sonnet-4"` |

### 端口配置

- **默认端口**: 8000
- **修改端口**（直接运行）：
  ```bash
  python -m uvicorn app:app --host 0.0.0.0 --port 3000
  ```
- **修改端口**（Docker）：
  ```bash
  HOST_PORT=3000 docker-compose up -d
  ```

---

## 启动和使用

### 启动流程

1. ✅ 检查 Python 版本（3.9+）
2. ✅ 安装依赖包
3. ✅ 配置 API 密钥
4. ✅ 启动服务
5. ✅ 打开浏览器访问

### 使用流程

1. **输入主题**
   - 可以是中文或英文
   - 例如："冒泡排序"、"bubble sort"、"熵增定律"

2. **生成动画**
   - 点击生成按钮
   - 等待流式输出完成
   - 动画会自动播放

3. **编辑和改进**
   - 在对话界面中与 AI 交互
   - 可以要求修改动画的特定部分
   - 支持多轮对话优化

### 示例输入

- **计算机科学**: "冒泡排序"、"快速排序"、"二分查找"
- **数学**: "欧拉定理"、"勾股定理"、"微积分"
- **物理**: "熵增定律"、"相对论"、"量子纠缠"
- **设计**: "affordance in design"、"用户体验设计"

---

## 常见问题

### Q1: 提示 "请在环境变量里配置 API_KEY"

**原因**: `credentials.json` 文件中的 `API_KEY` 仍然是默认值 `sk-REPLACE_ME`

**解决方法**:
1. 检查 `credentials.json` 文件是否存在
2. 确保 `API_KEY` 已正确填写
3. 确保文件格式正确（JSON 格式）

### Q2: 端口被占用

**错误信息**: `Address already in use` 或 `端口已被占用`

**解决方法**:
```bash
# 查找占用端口的进程
# macOS/Linux:
lsof -i :8000
# Windows:
netstat -ano | findstr :8000

# 杀死进程或使用其他端口
python -m uvicorn app:app --host 0.0.0.0 --port 3000
```

### Q3: 依赖安装失败

**可能原因**:
- 网络问题
- pip 版本过旧
- Python 版本不兼容

**解决方法**:
```bash
# 升级 pip
pip install --upgrade pip

# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 检查 Python 版本
python --version  # 应该是 3.9+
```

### Q4: Docker 镜像拉取失败

**解决方法**:
```bash
# 配置 Docker 镜像加速器（国内用户）
# 编辑 /etc/docker/daemon.json（Linux）或 Docker Desktop 设置
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com"
  ]
}

# 重启 Docker 服务
```

### Q5: 生成动画时出现错误

**可能原因**:
- API 密钥无效或过期
- API 配额用完
- 网络连接问题
- 模型不支持

**解决方法**:
1. 检查 API 密钥是否有效
2. 检查 API 账户余额或配额
3. 检查网络连接
4. 尝试更换模型

### Q6: 浏览器无法访问

**检查清单**:
- ✅ 服务是否已启动（查看终端输出）
- ✅ 端口是否正确
- ✅ 防火墙是否阻止访问
- ✅ 使用 `http://` 而不是 `https://`
- ✅ 使用 `localhost` 或 `127.0.0.1`

---

## 故障排除

### 检查服务状态

**直接运行方式：**
```bash
# 检查进程是否运行
ps aux | grep uvicorn  # macOS/Linux
tasklist | findstr python  # Windows

# 检查端口是否监听
netstat -an | grep 8000  # macOS/Linux
netstat -an | findstr 8000  # Windows
```

**Docker 方式：**
```bash
# 检查容器状态
docker-compose ps

# 查看容器日志
docker-compose logs fogsight

# 进入容器调试
docker-compose exec fogsight bash
```

### 重新安装依赖

如果遇到依赖问题，可以尝试：
```bash
# 删除旧的虚拟环境（如果使用）
rm -rf venv

# 重新创建虚拟环境（推荐）
python -m venv venv
source venv/bin/activate  # macOS/Linux
venv\Scripts\activate  # Windows

# 重新安装依赖
pip install -r requirements.txt
```

### 验证配置文件

检查 `credentials.json` 格式是否正确：
```bash
# 使用 Python 验证 JSON 格式
python -c "import json; json.load(open('credentials.json'))"
```

### 查看详细日志

**直接运行：**
```bash
# 启动时显示详细日志
python -m uvicorn app:app --host 0.0.0.0 --port 8000 --log-level debug
```

**Docker：**
```bash
# 实时查看日志
docker-compose logs -f --tail=100
```

### 重置环境

如果遇到无法解决的问题，可以尝试完全重置：

```bash
# 1. 停止所有服务
docker-compose down  # Docker 方式
# 或 Ctrl+C 停止直接运行的服务

# 2. 清理 Docker（如果使用 Docker）
docker-compose down -v
docker system prune -a

# 3. 删除并重新创建配置文件
rm credentials.json
cp demo-credentials.json credentials.json
# 然后重新配置 API 密钥

# 4. 重新安装依赖
pip install --upgrade -r requirements.txt

# 5. 重新启动
```

---

## 技术支持

如果以上方法都无法解决问题，您可以：

1. **查看项目文档**: 访问 [GitHub 仓库](https://github.com/fogsightai/fogsight)
2. **提交 Issue**: 在 GitHub 上提交问题报告
3. **联系支持**: 访问[项目 Wiki](https://fogsightai.feishu.cn/wiki/WvODwyUr1iSAe0kEyKfcpqvynGc?from=from_copylink)

---

## 附录

### 系统要求详细说明

| 组件 | 最低要求 | 推荐配置 |
|------|---------|---------|
| Python | 3.9 | 3.10+ |
| 内存 | 2GB | 4GB+ |
| 磁盘空间 | 500MB | 1GB+ |
| 网络 | 稳定的互联网连接 | 宽带连接 |

### 支持的 API 提供商

- ✅ Google Gemini（推荐）
- ✅ OpenRouter
- ✅ 其他 OpenAI 兼容的 API

### 开发模式

如果您想进行开发或调试：

```bash
# 启用自动重载（代码修改后自动重启）
python -m uvicorn app:app --host 0.0.0.0 --port 8000 --reload

# 或使用启动脚本后手动修改代码
```

---

**祝您使用愉快！如有问题，请参考常见问题部分或联系技术支持。**
