<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatTutor Agent - 具象</title>
    <link rel="stylesheet" href="/static/style.css?v={{ time }}">
    <link rel="icon" href="/static/favicon.png?v={{ time }}" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>

</head>
<body class="{{ 'show-chat-view' if view in ['chat', 'project', 'model', 'video'] else 'show-initial-view' }}">

    <div id="language-switcher" class="language-switcher"{% if view in ['chat', 'project', 'model', 'video'] %} style="display: none;"{% endif %}>
        <button data-lang="zh">中</button>
        <button data-lang="en">EN</button>
    </div>

    <div id="initial-view" class="initial-view">
        <img src="/static/logo.png" alt="Studio Logo" class="logo" id="logo-initial">

        <div class="initial-content">
            <div class="hero-group">
                <h1 data-translate-key="heroTitle">在此赋予概念以生命，转瞬之间</h1>
                <form id="initial-form" class="initial-form">
                    <div id="animated-placeholder" class="animated-placeholder"></div>
                    <input type="text" id="initial-input" required>
                    <button type="submit" data-translate-key="startCreatingTitle" title="开始创作">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M3 20V4l19 8Z"/></svg>
                    </button>
                </form>
            </div>
             <footer class="initial-footer">
                <a href="https://docs.qq.com/doc/DWExhWnBEdmhRVndp" data-translate-key="groupChat" target="_blank">联系我们/加入交流群</a>
            </footer>
        </div>
    </div>

    <div id="chat-view" class="chat-view">
        <aside class="chat-sidebar">
            <div class="sidebar-header">
                <img src="/static/logo.png" alt="ChatTutor Logo" class="sidebar-logo">
                <button class="sidebar-toggle" id="sidebar-toggle" title="切换边栏">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
                </button>
            </div>
            <button id="new-chat-button" class="sidebar-new-chat" data-translate-key="newChatTitle" title="新对话">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                <span data-translate-key="newChat">新对话</span>
            </button>
            <a id="model-button" class="sidebar-model" href="/model" title="建模">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 3l7 4v10l-7 4-7-4V7l7-4z"/>
                    <path d="M12 12l7-4"/>
                    <path d="M12 12v9"/>
                    <path d="M12 12l-7-4"/>
                </svg>
                <span>建模</span>
            </a>
            <a id="video-button" class="sidebar-model sidebar-video" href="/video" title="视频">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="5" width="14" height="14" rx="2"></rect>
                    <path d="M17 9l4-2v10l-4-2z"></path>
                </svg>
                <span>视频</span>
            </a>
            <div class="sidebar-search">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                <input id="chat-search-input" type="text" data-translate-key="searchChats" placeholder="搜索对话" autocomplete="off">
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-title-row">
                        <div class="nav-title" data-translate-key="projects">Projects</div>
                        <button id="project-create-button" class="nav-icon-button" title="新建项目" data-translate-key="createProject">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                        </button>
                    </div>
                    <div id="project-list" class="sidebar-list"></div>
                </div>
                <div class="nav-section" id="chat-list-section">
                    <div id="chat-list-title" class="nav-title" data-translate-key="recentChats">Chats</div>
                    <div id="chat-list" class="sidebar-list"></div>
                </div>
            </nav>
        </aside>
        <div class="chat-main">
            <header class="chat-header">
                <div class="header-title">
                    <span id="header-app-title">ChatTutor</span>
                </div>
                <div class="header-actions">
                    <button class="header-action-btn" title="用户设置">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    </button>
                </div>
            </header>
            <section id="project-view" class="project-view">
                <div class="project-hero">
                    <div class="project-title-row">
                        <div class="project-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 7h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z"/>
                                <path d="M4 7l2-3h6l2 3"/>
                            </svg>
                            <span id="project-title-text">Project</span>
                        </div>
                    </div>
                </div>
                <div class="project-composer">
                    <form id="project-chat-form" class="project-chat-form">
                        <button type="button" class="project-chat-add" title="添加" aria-label="添加">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <input id="project-chat-input" type="text" autocomplete="off" data-translate-key="projectChatPlaceholder" placeholder="在 {project} 中新建对话">
                        <div class="project-chat-actions">
                            <button type="button" class="project-chat-icon" title="Voice" aria-label="Voice">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 1v22"/>
                                    <path d="M8 6a4 4 0 0 1 8 0v6a4 4 0 0 1-8 0z"/>
                                </svg>
                            </button>
                            <button type="button" class="project-chat-icon" title="Quick audio" aria-label="Quick audio">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12h4l3 8 4-16 3 8h4"/>
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>
                <div id="project-chat-list" class="project-chat-list"></div>
            </section>
            <section id="model-view" class="model-view">
                <div class="model-hero">
                    <div class="model-title-row">
                        <h2>建模</h2>
                        <p>输入知识点或模型名称，生成可交互式模型。</p>
                    </div>
                    <form id="model-form" class="model-form">
                        <span class="model-input-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="7"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </svg>
                        </span>
                        <input id="model-input" type="text" placeholder="例如：圆锥曲线、三角函数、立体几何" autocomplete="off">
                        <button class="model-submit" type="submit" aria-label="生成模型">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m5 12 14-7-7 14-2-6-5-1z"></path>
                            </svg>
                        </button>
                    </form>
                    <div class="model-suggestions">
                        <div class="model-section-title">热门模型</div>
                        <div class="model-card-row">
                            <button class="model-card" type="button" data-model-prompt="圆锥曲线：双曲线与渐近线">
                                <span>圆锥曲线</span>
                                <small>双曲线与渐近线</small>
                            </button>
                            <button class="model-card" type="button" data-model-prompt="三角函数：单位圆与角度变化">
                                <span>三角函数</span>
                                <small>单位圆与角度变化</small>
                            </button>
                            <button class="model-card" type="button" data-model-prompt="立体几何：正四面体与外接球">
                                <span>立体几何</span>
                                <small>正四面体与外接球</small>
                            </button>
                            <button class="model-card" type="button" data-model-prompt="函数曲线：抛物线参数控制">
                                <span>函数曲线</span>
                                <small>抛物线参数控制</small>
                            </button>
                        </div>
                    </div>
                    <div id="model-output" class="model-output">
                        <div class="model-placeholder">
                            <p>模型将在这里生成。</p>
                        </div>
                    </div>
                </div>
            </section>
            <section id="video-view" class="video-view">
                <div class="new-chat-hero">
                    <h2 class="new-chat-welcome">我们从哪开始？</h2>
                    <form id="video-form" class="new-chat-form">
                        <button type="submit" class="new-chat-add" aria-label="New video">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <input id="video-input" class="new-chat-input" type="text" autocomplete="off" placeholder="Ask anything">
                        <div class="new-chat-actions">
                            <button type="button" class="new-chat-icon" title="Voice">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 1v22"/>
                                    <path d="M8 6a4 4 0 0 1 8 0v6a4 4 0 0 1-8 0z"/>
                                </svg>
                            </button>
                            <button type="button" class="new-chat-icon" title="Quick audio">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12h4l3 8 4-16 3 8h4"/>
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>
                <main id="video-log" class="chat-log">
                </main>
            </section>
            <section id="new-chat-view" class="new-chat-view">
                <div class="new-chat-hero">
                    <h2 class="new-chat-welcome" data-translate-key="newChatWelcome">我们从哪开始？</h2>
                    <form id="new-chat-form" class="new-chat-form">
                        <button type="submit" class="new-chat-add" aria-label="New chat">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <input id="new-chat-input" type="text" autocomplete="off" data-translate-key="chatPlaceholder" placeholder="Ask anything">
                        <div class="new-chat-actions">
                            <button type="button" class="new-chat-icon" title="Voice">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 1v22"/>
                                    <path d="M8 6a4 4 0 0 1 8 0v6a4 4 0 0 1-8 0z"/>
                                </svg>
                            </button>
                            <button type="button" class="new-chat-icon" title="Quick audio">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12h4l3 8 4-16 3 8h4"/>
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>
            </section>
            <main id="chat-log" class="chat-log">
                <div id="chat-welcome" class="chat-welcome">
                    <h2>What are you working on?</h2>
                </div>
            </main>
            <footer class="chat-footer">
                <form id="chat-form" class="chat-form">
                    <div class="input-container">
                        <button type="button" class="input-attach" title="附加文件">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                        </button>
                        <input type="text" id="chat-input" data-translate-key="chatPlaceholder" placeholder="Ask anything" autocomplete="off" required>
                        <button type="submit" class="submit-button" data-translate-key="sendTitle" title="发送">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </div>
                </form>
            </footer>
        </div>
    </div>



    <template id="user-message-template">
        <div class="message-group user"><div class="message-bubble">${text}</div></div>
    </template>
    
    <template id="agent-status-template">
        <div class="message-group agent">
            <div class="status-bubble">
                <div class="thinking-dots"><span></span><span></span><span></span></div>
                <p>${text}</p>
            </div>
        </div>
    </template>

    <template id="agent-error-template">
        <div class="message-group agent">
            <div class="status-bubble error-bubble">
                <svg viewBox="0 0 24 24" class="icon-error"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg>
                <p>${text}</p>
            </div>
        </div>
    </template>

    <template id="agent-code-template">
        <div class="message-group agent has-code">
            <details class="code-details" open>
                <summary class="code-summary">
                    <div class="summary-title">
                        <svg class="icon-code" viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                        <span data-translate-key="generatingCode">生成代码中...</span>
                    </div>
                    <svg class="icon-chevron" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
                </summary>
                <div class="code-content"><pre><code></code></pre></div>
            </details>
        </div>
    </template>
    
    <template id="animation-player-template">
        <div class="message-group agent has-player">
            <div class="player-container">
                <div class="iframe-wrapper"><iframe class="animation-iframe" sandbox="allow-scripts allow-same-origin"></iframe></div>
                <div class="player-controls-bar">
                    <button class="control-btn play-pause-btn" type="button" title="播放/暂停">
                        <svg class="play-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <svg class="pause-icon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                        </svg>
                    </button>
                    <div class="volume-control-wrapper">
                        <button class="control-btn volume-btn" type="button" title="音量">
                            <svg class="volume-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
                            </svg>
                            <svg class="mute-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                <line x1="23" y1="9" x2="17" y2="15"/>
                                <line x1="17" y1="9" x2="23" y2="15"/>
                            </svg>
                        </button>
                        <div class="volume-slider-container">
                            <input type="range" class="volume-slider" min="0" max="1" step="0.01" value="1.0">
                        </div>
                    </div>
                    <div class="time-display">
                        <span class="current-time">00:00</span>
                        <span class="time-separator">/</span>
                        <span class="total-time">00:00</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-filled"></div>
                            <div class="progress-handle"></div>
                        </div>
                    </div>
                    <button class="control-btn fullscreen-btn" type="button" title="全屏">
                        <svg class="fullscreen-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                        </svg>
                        <svg class="exit-fullscreen-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                            <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </template>

    <div id="feature-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="modal-close-button" class="modal-close-button" title="Close">×</button>
            <p data-translate-key="featureComingSoon">该功能正在开发中...</p>
            <button id="modal-github-button" class="modal-button" data-translate-key="visitGitHub">访问 GitHub</button>
        </div>
    </div>

    <div id="project-modal" class="modal-overlay">
        <div class="modal-content project-modal-content">
            <div class="project-modal-header">
                <h3 data-translate-key="createProject">新建项目</h3>
                <div class="project-modal-actions">
                    <button type="button" class="modal-icon-button" title="Settings" aria-label="Settings">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c0 .66.39 1.26 1 1.51H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                    </button>
                    <button id="project-modal-close" class="modal-close-button" title="Close" aria-label="Close">×</button>
                </div>
            </div>
            <div class="project-form">
                <label data-translate-key="projectName">项目名称</label>
                <div class="project-input-row">
                    <span class="project-input-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="9"></circle>
                            <path d="M8.5 10.5h.01M15.5 10.5h.01"></path>
                            <path d="M8 15s2 2 4 2 4-2 4-2"></path>
                        </svg>
                    </span>
                    <input type="text" id="project-name-input" class="project-input" placeholder="例如：市场调研" data-translate-key="projectNamePlaceholder" autocomplete="off">
                </div>
                <div class="project-tag-row">
                    <button type="button" class="project-tag tag-green">语文</button>
                    <button type="button" class="project-tag tag-blue">数学</button>
                    <button type="button" class="project-tag tag-purple">英语</button>
                    <button type="button" class="project-tag tag-yellow">其他</button>
                </div>
                <div class="project-submit-row">
                    <button id="project-create-submit" class="project-submit-button" data-translate-key="createProjectAction">创建项目</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/script.js?v={{ time }}"></script>

    <div id="overlay" class="overlay" style="display: none;"></div>
    <div id="warning-box" class="warning-box" style="display: none;">
    <span id="warning-message">警告信息</span>
    <button class="close-button" onclick="hideWarning()">×</button>
    </div>
</body>
</html>
